# Markdown转PDF工具 📝➡️📄

一款功能强大的Markdown文档转PDF工具，支持数学公式、中文、Emoji符号等多种格式。

## 📋 目录

- [🌟 核心特性](#-核心特性)
- [📋 系统要求](#-系统要求)
- [🚀 快速开始](#-快速开始)
- [🎯 详细使用指南](#-详细使用指南)
- [🧩 数学公式支持](#-数学公式支持)
- [😊 Emoji符号支持](#-emoji符号支持)
- [🔧 高级功能](#-高级功能)
- [🧪 测试与诊断](#-测试与诊断)
- [📊 使用场景](#-使用场景)
- [🔧 故障排除](#-故障排除)
- [📁 项目结构](#-项目结构)
- [🆕 版本历史](#-版本历史)
- [📞 技术支持](#-`

## 🌟 核心特性

### 🔄 双模式转换

- **单文件转换**：精确控制单个Markdown文件的转换
- **批量转换**：支持多种批量操作方式，提高工作效率

### 📁 智能文件管理（批量模式）

- **添加单个文件**：逐个选择Markdown文件
- **添加整个文件夹**：一键添加文件夹中所有.md文件
- **递归搜索**：自动遍历子文件夹中的Markdown文件
- **重复文件过滤**：自动跳过已存在的文件
- **文件列表管理**：支持移除选中文件和清空列表

### 🧩 数学公式支持 ⭐

- **LaTeX数学公式**：完整支持行内公式 `$...$` 和块级公式 `$$...$$`
- **专业渲染引擎**：集成MathJax提供高质量数学公式渲染
- **广泛公式支持**：支持微积分、线性代数、物理、化学等各种数学表达式
- **准确转换**：确保PDF中数学公式的正确显示和排版

### 😊 Emoji符号支持 ⭐

- **完整Emoji支持**：支持各种Emoji表情符号和特殊符号
- **智能字体配置**：多层Fallback机制确保符号正确显示
- **跨平台兼容**：支持Windows、macOS等多种系统环境

### 🎨 用户界面

- **Tab页切换**：清晰的标签页设计，方便在不同模式间切换
- **智能默认路径**：单文件模式下自动设置源文件同目录为输出路径
- **实时路径预览**：显示完整的输出路径信息
- **现代化设计**：清爽的界面风格，良好的用户体验

### ⚙️ 自定义设置

- **灵活的页面设置**：
  - 多种页面尺寸（A4、A3、Letter、Legal）
  - 可调节页面边距（上下左右独立设置）
  - 多种编码格式支持（UTF-8、GBK、GB2312）
- **个性化页眉页脚**：支持自定义文本内容
- **详细的操作反馈**：每步操作都有明确的结果提示

## 📋 系统要求

- Windows 7/8/10/11
- Python 3.7 或更高版本
- wkhtmltopdf 工具

## 🚀 快速开始

### 1. 安装依赖

```bash
# 安装Python依赖
pip install -r requirements.txt

# 或者单独安装
pip install markdown2 pdfkit PyQt5
```

### 2. 安装wkhtmltopdf

#### 自动安装（推荐）
程序会自动检测并提示安装wkhtmltopdf

#### 手动安装
1. 访问 [wkhtmltopdf官网](https://wkhtmltopdf.org/downloads.html)
2. 下载适合您系统的版本
3. 安装时选择"Add to PATH"选项
4. 重启程序

### 3. 运行程序

```bash
python Markdown2PDF.py
```

## 🎯 详细使用指南

### 界面布局说明

**优化后的布局特点**：

- **左右分区设计**：页面设置在左侧，控制区域在右侧
- **紧凑的空间利用**：消除了原有布局中的空白区域
- **响应式调整**：各组件大小自动适应窗口变化
- **清晰的信息层次**：重要控件突出显示

### 单文件转换模式

1. **切换到单文件模式**
   - 点击顶部标签页中的"单文件转换"

2. **选择文件**
   - 点击"浏览"按钮选择要转换的Markdown文件
   - **默认行为**：输出路径自动设置为源文件同目录
   - 可选择自定义输出位置

3. **设置转换选项**
   - 选择页面尺寸和编码格式
   - 调整页面边距
   - （可选）设置页眉页脚文本

4. **开始转换**
   - 点击"开始转换"按钮
   - 观察进度和日志信息

### 批量转换模式

1. **切换到批量模式**
   - 点击顶部标签页中的"批量转换"

2. **添加文件的多种方式**

   **方式一：添加单个文件**
   - 点击"添加文件"按钮选择多个Markdown文件
   - 可以多次添加文件

   **方式二：添加整个文件夹** ⭐（新增功能）
   - 点击"添加文件夹"按钮选择包含Markdown文件的文件夹
   - 程序会自动扫描文件夹及所有子文件夹
   - 自动识别并添加所有.md文件
   - 智能跳过重复文件
   - 显示添加结果统计

3. **管理文件列表**
   - **移除文件**：选择文件后点击"移除选中"
   - **清空列表**：点击"清空列表"移除所有文件
   - **查看文件路径**：鼠标悬停在文件上可查看完整路径

4. **设置输出位置**
   - 选择PDF文件的统一输出文件夹

5. **配置转换参数**
   - 设置统一的页面格式和边距
   - 配置页眉页脚（所有文件通用）

6. **执行批量转换**
   - 点击"开始转换"按钮
   - 系统会依次转换所有文件

## 🧩 数学公式支持

### 支持的公式格式

**完全支持的标准LaTeX语法**：

```
# 基础数学
行内公式：$a^2 + b^2 = c^2$
分数：$\frac{a+b}{c-d}$ 或 $\frac{1}{n}\sum_{i=1}^{n} x_i$
平方根：$\sqrt{x}$ 或 $\sqrt[3]{x}$
上下标：$x_1^2$, $e^{i\pi}$, $H_2O$

# 微积分
导数：$\frac{dy}{dx}$, $\frac{\partial f}{\partial x}$
积分：$\int_a^b f(x) dx$, $\int_0^{\infty} e^{-x^2} dx$
极限：$\lim_{x \to 0}$, $\lim_{n \to \infty}$

# 统计学
平均值：$\bar{x} = \frac{1}{n}\sum_{i=1}^{n} x_i$
方差：$\sigma^2 = \frac{1}{n}\sum_{i=1}^{n} (x_i - \bar{x})^2$
标准差：$\sigma = \sqrt{\frac{1}{n}\sum_{i=1}^{n} (x_i - \bar{x})^2}$

# 化学方程式
$2H_2O \rightarrow 2H_2 + O_2$
$CH_4 + 2O_2 \rightarrow CO_2 + 2H_2O$

# 向量和矩阵
$\vec{v} = \begin{pmatrix} x \\ y \end{pmatrix}$
$\det(A) = |A|$
```

### 已修复的问题

✅ **平方根处理**：正确处理 `\sqrt{x}` 和 `\sqrt[3]{x}`  
✅ **偏导数显示**：正确显示 `\frac{\partial f}{\partial x}`  
✅ **平均值符号**：正确处理 `\bar{x}` 上划线  
✅ **化学分子式**：正确显示 `H_2O`, `CH_4` 等  
✅ **向量符号**：支持 `\vec{v}` 表示  
✅ **矩阵环境**：基本支持 `pmatrix` 环境  

### 支持的数学内容

- **基础运算**：+、-、×、÷、=、≠、≤、≥、±
- **函数符号**：sin、cos、tan、log、ln、exp
- **希腊字母**：α、β、γ、δ、θ、λ、μ、π、σ、φ、ω
- **特殊符号**：∞、∫、∑、∂、∇、∈、⊂、∪、∩
- **化学元素**：H₂O、CH₄、CO₂ 等下标格式
- **箭头符号**：→、↔、⇒、⇔

### 使用建议

1. **优先使用标准LaTeX语法**
2. **避免过于复杂的矩阵环境**
3. **测试文件验证**：使用 `fixed_math_test.md` 验证效果
4. **逐步添加复杂公式**：从简单到复杂逐步测试

### 已知限制

- 不支持复杂的array和tabular环境
- 不支持颜色和字体样式控制
- 极其复杂的多层嵌套公式可能显示简化
- 某些特殊的手写体或花体字母不支持

## 😊 Emoji符号支持

### 💡 技术实现

本工具通过智能字体配置确保Emoji符号在PDF中正确显示：

``css
font-family: "Segoe UI Emoji", "Apple Color Emoji", "Noto Color Emoji",
             "Segoe UI Symbol", "Symbola", "DejaVu Sans", "FreeSans",
             "Microsoft YaHei", Arial, sans-serif;
```

### ✅ 支持的Emoji类型

- 📋 基本符号（清单、书籍等）
- 😊 表情符号
- ⚙️ 工具符号
- 🎓 教育相关符号
- 💻 技术符号
- 🧪 科学符号
- 🎨 艺术符号

### 🔧 字体优先级

1. **Segoe UI Emoji** - Windows系统原生Emoji字体
2. **Apple Color Emoji** - macOS系统Emoji字体  
3. **Noto Color Emoji** - Google跨平台Emoji字体
4. **Segoe UI Symbol** - Windows符号字体
5. **Symbola** - 专业符号字体
6. **DejaVu Sans** - 开源字体，良好Unicode支持
7. **FreeSans** - GNU FreeFont系列
8. **Microsoft YaHei** - 微软雅黑中文字体
9. **Arial** - 基础西文字体
10. **sans-serif** - 通用无衬线字体

### 📋 Emoji显示问题解决

#### 问题现象
- 标题行Emoji显示正常，但内容中显示为方框 ❌
- 相同的Emoji在不同位置显示效果不一致 ❌

#### 解决方案
1. **确保系统字体安装**
   - Windows系统应自带Segoe UI Emoji字体
   - 可额外安装Noto Color Emoji字体获得更好兼容性

2. **检查PDF查看器**
   - 推荐使用Adobe Reader、Foxit Reader等专业PDF查看器
   - 避免使用浏览器内置PDF查看器

3. **验证字体配置**
   ```bash
   # 运行测试脚本验证
   python simple_emoji_test.py
   ```

4. **如果仍有问题**
   - 尝试重新安装wkhtmltopdf完整版
   - 检查系统语言和区域设置
   - 确保使用UTF-8编码保存Markdown文件

## 🔧 高级功能

### 📁 文件管理优化

- **重复检测**：智能识别并跳过重复文件
- **递归搜索**：自动遍历所有子文件夹
- **批量操作**：支持文件列表的整体管理
- **路径预览**：实时显示完整的输出路径信息

### 📐 智能路径管理

- **单文件模式**：自动推断输出路径，减少用户操作
- **批量模式**：统一管理多个文件的输出位置
- **默认路径**：智能设置源文件同目录为输出路径

### 🎨 格式支持

- 支持标准Markdown语法
- 支持表格、代码块、列表等复杂格式
- 支持中文内容的正确显示
- **专业数学公式渲染**
- **完整Emoji符号支持**

### ⚙️ 自定义选项

- 灵活的边距调整（0-50mm）
- 多种页面尺寸选择
- 不同编码格式适配
- 个性化页眉页脚设置

## 🧪 测试与诊断

### 综合测试套件特点

#### 🔍 智能路径查找

- **程序目录扫描**：自动检查bin文件夹和根目录
- **环境变量检测**：智能搜索PATH中的wkhtmltopdf
- **常见位置匹配**：预设Windows标准安装路径
- **注册表查询**：Windows注册表深度查找
- **多重备份机制**：确保不遗漏任何可能位置

#### 📊 全方位测试覆盖

**基础验证测试**：
- 系统环境信息收集
- 安装路径完整性检查
- 文件属性和权限验证
- 版本信息准确性确认

**功能完整性测试**：
- 简单HTML到PDF转换
- 复杂HTML文档渲染
- CSS样式和排版验证
- 中文内容正确显示

**性能基准测试**：
- 多页文档转换速度
- 资源消耗监控
- 超时保护机制
- 性能等级评估

#### 🎯 智能评分系统

- **权重化评估**：不同测试项按重要程度分配权重
- **分级报告**：优秀(≥90)、良好(≥70)、一般(≥50)、较差(<50)
- **详细诊断**：每个测试项的具体结果和建议
- **时间统计**：精确的测试耗时记录

#### 🛡️ 健壮性保障

- **异常处理**：完善的错误捕获和恢复机制
- **资源管理**：自动清理临时测试文件
- **超时控制**：防止测试进程hang住
- **兼容性检查**：多版本和系统环境适配

### 运行测试

```bash
# 运行wkhtmltopdf环境平台测试脚本
python test_wkhtmltopdf_unified.py
```

### 测试结果解读

**优秀（≥90分）**：
✅ 所有核心功能测试全部通过
✅ 安装路径智能查找成功
✅ 功能完整性验证完全通过
✅ 性能基准测试达到高效水平
✅ 无任何错误或严重警告

**良好（70-89分）**：
✅ 核心功能正常可用
✅ 主要安装验证通过
✅ 存在个别非关键项警告
✅ 性能表现正常
⚠️ 可能存在环境配置优化空间

**一般（50-69分）**：
⚠️ 部分非核心功能受限
⚠️ 安装路径需要手动指定
⚠️ 某些复杂文档渲染可能有问题
⚠️ 性能表现有待提升
🔧 建议检查配置并优化环境

**较差（<50分）**：
❌ 核心安装验证失败
❌ 关键功能无法正常使用
❌ wkhtmltopdf未正确安装或配置
❌ 基础转换功能异常
🚨 必须重新检查安装和配置

## 📊 使用场景

### 适合单文件转换的场景

- 转换重要的单篇文档
- 需要精确控制输出位置
- 对特定文件进行特殊设置
- 快速转换临时文件
- **学术论文和数学文档**

### 适合批量转换的场景

- 处理大量Markdown文件
- 统一格式要求的文档集合
- 定期批量处理文档需求
- 项目文档的整体转换
- **处理整个项目文件夹**
- **批量转换学术资料**

## 🔧 故障排除

### 常见问题

1. **"未找到wkhtmltopdf"错误**
   - 确保已正确安装wkhtmltopdf
   - 检查是否添加到系统PATH环境变量
   - 程序会提供手动指定路径的选项

2. **中文显示乱码**
   - 确保选择正确的编码格式（推荐UTF-8）
   - 检查Markdown文件本身的编码

3. **转换速度慢**
   - 大文件或多文件转换需要一定时间
   - 查看日志了解具体进度

4. **PDF格式问题**
   - 调整页面边距设置
   - 检查Markdown语法是否规范

5. **Emoji符号显示问题**
   - 参考[Emoji符号支持](#-emoji符号支持)章节
   - 检查系统字体安装情况
   - 验证PDF查看器兼容性

### 日志文件

程序会在同目录下生成 `markdown2pdf.log` 日志文件，包含详细的运行信息。

### wkhtmltopdf配置问题

如果遇到"找不到wkhtmltopdf"错误：

1. **检查安装路径**
   ```
   默认安装路径：
   - C:\Program Files\wkhtmltopdf\bin\wkhtmltopdf.exe
   - C:\Program Files (x86)\wkhtmltopdf\bin\wkhtmltopdf.exe
   ```

2. **手动配置路径**
   编辑 `wkhtmltopdf_config.json` 文件：
   ```json
   {
     "wkhtmltopdf_path": "您的实际安装路径\\wkhtmltopdf.exe"
   }
   ```

3. **验证安装**
   在命令行中测试：
   ```cmd
   wkhtmltopdf --version
   ```

## 📁 项目结构

```
Markdown转PDF工具/
├── Markdown2PDF.py                 # 主程序文件
├── requirements.txt                # Python依赖列表
├── README.md                      # 使用说明
├── markdown2pdf.log               # 运行日志（自动生成）
├── wkhtmltopdf_config.json        # 配置文件（自动生成）
├── test_sample.md                 # 基础测试文件
├── math_test.md                   # 数学公式测试文件
├── test_document2.md              # 批量测试文件
├── test_wkhtmltopdf_unified.py    # wkhtmltopdf 环境平台测试脚本
├── simple_emoji_test.py           # 简化Emoji测试
├── comprehensive_test.py          # 综合功能测试
├── specific_emoji_test.py         # 特定Emoji符号测试
├── emoji_debug_test.py            # Emoji解析调试
└── screenshots/                   # 界面截图（示例）
```

## 🆕 版本历史

### v2.6 综合测试套件版（当前版本）

- ✨ 全新统一测试框架，整合所有测试功能
- ✨ 智能路径查找算法，支持注册表深度搜索
- ✨ 权重化评分系统，提供精准的质量评估
- ✨ 全方位功能验证，包括性能基准测试
- ✨ 详细的诊断报告和改进建议
- ✨ 增强的异常处理和资源管理机制

### v2.5 数学公式支持版

- ✨ 全新集成MathJax数学公式渲染引擎
- ✨ 完整支持LaTeX数学公式语法
- ✨ 支持行内公式和块级公式
- ✨ 专业的数学符号和表达式渲染
- ✨ 添加专门的数学公式测试文件

### v2.4 文件夹批量添加功能

- ✨ 批量转换新增文件夹选择功能
- ✨ 支持递归搜索子文件夹中的Markdown文件
- ✨ 智能重复文件检测和过滤
- ✨ 详细的文件添加结果反馈

### v2.3 界面优化版

- ✨ 恢复页面设置为传统单列布局
- ✨ 保持单文件默认路径功能
- ✨ 优化整体界面布局

### v2.2 功能增强版

- ✨ 单文件转换默认输出到源文件同目录
- ✨ 全新优化的UI布局，消除空白区域
- ✨ 增强的路径预览和管理功能

### v2.1 主要特性

- ✨ 新增Tab页界面设计
- ✨ 支持单文件精确转换模式
- ✨ 增强的批量文件管理功能
- ✨ 实时文件名预览功能

### v2.0 核心功能

- 完善的依赖检查和自动安装
- 改进的错误处理机制
- 更丰富的页面设置选项
- 实时日志显示
- 配置文件持久化
- 更美观的用户界面

### v1.0 初始版本

- 🎉 基础Markdown转PDF功能
- ✅ 数学公式支持
- ✅ 批量转换功能
- ✅ 中文和Emoji符号支持

## 📞 技术支持

如遇到问题，请：

1. 查看日志文件 `markdown2pdf.log`
2. 检查是否满足系统要求
3. 确认wkhtmltopdf正确安装
4. 参考常见问题解决方案
5. 测试提供的数学公式示例文件
6. 运行统一测试套件进行诊断

## 📄 许可证

本项目仅供学习和使用。

---
**注意**：使用前请确保已安装所有必需的依赖项，特别是wkhtmltopdf工具。
# Markdown批量转PDF工具

这是一个功能强大的Markdown文件转换为PDF格式的工具，支持单文件和批量转换，具有智能的文件管理和优化的用户界面。

## 📋 目录

- [🌟 核心特性](#-核心特性)
- [📋 系统要求](#-系统要求)
- [🚀 快速开始](#-快速开始)
- [🎯 详细使用指南](#-详细使用指南)
- [🔧 高级功能](#-高级功能)
- [🧪 测试与诊断](#-测试与诊断)
- [📊 使用场景](#-使用场景)
- [🔧 故障排除](#-故障排除)
- [🧩 数学公式支持](#-数学公式支持)
- [📁 项目结构](#-项目结构)
- [🆕 版本历史](#-版本历史)
- [📞 技术支持](#-`

## 🌟 核心特性

### 🔄 双模式转换

- **单文件转换**：精确控制单个Markdown文件的转换
- **批量转换**：支持多种批量操作方式，提高工作效率

### 📁 智能文件管理（批量模式）

- **添加单个文件**：逐个选择Markdown文件
- **添加整个文件夹**：一键添加文件夹中所有.md文件
- **递归搜索**：自动遍历子文件夹中的Markdown文件
- **重复文件过滤**：自动跳过已存在的文件
- **文件列表管理**：支持移除选中文件和清空列表

### ✨ 数学公式支持 ⭐（全新功能）

- **LaTeX数学公式**：完整支持行内公式 `$...$` 和块级公式 `$$...$$`
- **专业渲染引擎**：集成MathJax提供高质量数学公式渲染
- **广泛公式支持**：支持微积分、线性代数、物理、化学等各种数学表达式
- **准确转换**：确保PDF中数学公式的正确显示和排版

### 🌐 完全离线支持 ⭐（重要修复）

- **零网络依赖**：彻底移除所有CDN和外部资源引用
- **本地化处理**：所有功能均可在无网络环境下正常运行
- **稳定可靠**：避免因网络问题导致的转换失败
- **企业友好**：适用于内网和防火墙环境

### 🧪 全面测试套件 ⭐（新增功能）

- **统一测试框架**：整合所有测试功能于一体的专业测试工具
- **多层次验证**：涵盖安装、配置、功能、性能等全方位测试
- **智能诊断**：基于权重的评分系统和详细的错误定位
- **跨平台兼容**：支持Windows系统下的完整测试流程

### 🎨 用户界面

- **Tab页切换**：清晰的标签页设计，方便在不同模式间切换
- **智能默认路径**：单文件模式下自动设置源文件同目录为输出路径
- **实时路径预览**：显示完整的输出路径信息
- **现代化设计**：清爽的界面风格，良好的用户体验

### ⚙️ 自定义设置

- **灵活的页面设置**：
  - 多种页面尺寸（A4、A3、Letter、Legal）
  - 可调节页面边距（上下左右独立设置）
  - 多种编码格式支持（UTF-8、GBK、GB2312）
- **个性化页眉页脚**：支持自定义文本内容
- **详细的操作反馈**：每步操作都有明确的结果提示

## 📋 系统要求

- Windows 7/8/10/11
- Python 3.7 或更高版本
- wkhtmltopdf 工具

## 🚀 快速开始

### 1. 安装依赖

```bash
# 安装Python依赖
pip install -r requirements.txt

# 或者单独安装
pip install markdown2 pdfkit PyQt5
```

### 2. 安装wkhtmltopdf

#### 自动安装（推荐）
程序会自动检测并提示安装wkhtmltopdf

#### 手动安装
1. 访问 [wkhtmltopdf官网](https://wkhtmltopdf.org/downloads.html)
2. 下载适合您系统的版本
3. 安装时选择"Add to PATH"选项
4. 重启程序

### 3. 运行程序

```bash
python Markdown2PDF.py
```

## 🎯 详细使用指南

### 界面布局说明

**优化后的布局特点**：

- **左右分区设计**：页面设置在左侧，控制区域在右侧
- **紧凑的空间利用**：消除了原有布局中的空白区域
- **响应式调整**：各组件大小自动适应窗口变化
- **清晰的信息层次**：重要控件突出显示

### 单文件转换模式

1. **切换到单文件模式**
   - 点击顶部标签页中的"单文件转换"

2. **选择文件**
   - 点击"浏览"按钮选择要转换的Markdown文件
   - **默认行为**：输出路径自动设置为源文件同目录
   - 可选择自定义输出位置

3. **设置转换选项**
   - 选择页面尺寸和编码格式
   - 调整页面边距
   - （可选）设置页眉页脚文本

4. **开始转换**
   - 点击"开始转换"按钮
   - 观察进度和日志信息

### 批量转换模式

1. **切换到批量模式**
   - 点击顶部标签页中的"批量转换"

2. **添加文件的多种方式**

   **方式一：添加单个文件**
   - 点击"添加文件"按钮选择多个Markdown文件
   - 可以多次添加文件

   **方式二：添加整个文件夹** ⭐（新增功能）
   - 点击"添加文件夹"按钮选择包含Markdown文件的文件夹
   - 程序会自动扫描文件夹及所有子文件夹
   - 自动识别并添加所有.md文件
   - 智能跳过重复文件
   - 显示添加结果统计

3. **管理文件列表**
   - **移除文件**：选择文件后点击"移除选中"
   - **清空列表**：点击"清空列表"移除所有文件
   - **查看文件路径**：鼠标悬停在文件上可查看完整路径

4. **设置输出位置**
   - 选择PDF文件的统一输出文件夹

5. **配置转换参数**
   - 设置统一的页面格式和边距
   - 配置页眉页脚（所有文件通用）

6. **执行批量转换**
   - 点击"开始转换"按钮
   - 系统会依次转换所有文件

## 🔧 高级功能

### 📁 文件管理优化

- **重复检测**：智能识别并跳过重复文件
- **递归搜索**：自动遍历所有子文件夹
- **批量操作**：支持文件列表的整体管理
- **路径预览**：实时显示完整的输出路径信息

### 📐 智能路径管理

- **单文件模式**：自动推断输出路径，减少用户操作
- **批量模式**：统一管理多个文件的输出位置
- **默认路径**：智能设置源文件同目录为输出路径

### 🎨 格式支持

- 支持标准Markdown语法
- 支持表格、代码块、列表等复杂格式
- 支持中文内容的正确显示
- **专业数学公式渲染**
- **完整Emoji符号支持**

### ⚙️ 自定义选项

- 灵活的边距调整（0-50mm）
- 多种页面尺寸选择
- 不同编码格式适配
- 个性化页眉页脚设置

## 🧪 测试与诊断

### 综合测试套件特点

#### 🔍 智能路径查找

- **程序目录扫描**：自动检查bin文件夹和根目录
- **环境变量检测**：智能搜索PATH中的wkhtmltopdf
- **常见位置匹配**：预设Windows标准安装路径
- **注册表查询**：Windows注册表深度查找
- **多重备份机制**：确保不遗漏任何可能位置

#### 📊 全方位测试覆盖

**基础验证测试**：
- 系统环境信息收集
- 安装路径完整性检查
- 文件属性和权限验证
- 版本信息准确性确认

**功能完整性测试**：
- 简单HTML到PDF转换
- 复杂HTML文档渲染
- CSS样式和排版验证
- 中文内容正确显示

**性能基准测试**：
- 多页文档转换速度
- 资源消耗监控
- 超时保护机制
- 性能等级评估

#### 🎯 智能评分系统

- **权重化评估**：不同测试项按重要程度分配权重
- **分级报告**：优秀(≥90)、良好(≥70)、一般(≥50)、较差(<50)
- **详细诊断**：每个测试项的具体结果和建议
- **时间统计**：精确的测试耗时记录

#### 🛡️ 健壮性保障

- **异常处理**：完善的错误捕获和恢复机制
- **资源管理**：自动清理临时测试文件
- **超时控制**：防止测试进程hang住
- **兼容性检查**：多版本和系统环境适配

### 运行测试

```bash
# 运行wkhtmltopdf环境平台测试脚本
python test_wkhtmltopdf_unified.py
```

### 测试结果解读

**优秀（≥90分）**：
✅ 所有核心功能测试全部通过
✅ 安装路径智能查找成功
✅ 功能完整性验证完全通过
✅ 性能基准测试达到高效水平
✅ 无任何错误或严重警告

**良好（70-89分）**：
✅ 核心功能正常可用
✅ 主要安装验证通过
✅ 存在个别非关键项警告
✅ 性能表现正常
⚠️ 可能存在环境配置优化空间

**一般（50-69分）**：
⚠️ 部分非核心功能受限
⚠️ 安装路径需要手动指定
⚠️ 某些复杂文档渲染可能有问题
⚠️ 性能表现有待提升
🔧 建议检查配置并优化环境

**较差（<50分）**：
❌ 核心安装验证失败
❌ 关键功能无法正常使用
❌ wkhtmltopdf未正确安装或配置
❌ 基础转换功能异常
🚨 必须重新检查安装和配置

## 📊 使用场景

### 适合单文件转换的场景

- 转换重要的单篇文档
- 需要精确控制输出位置
- 对特定文件进行特殊设置
- 快速转换临时文件
- **学术论文和数学文档**

### 适合批量转换的场景

- 处理大量Markdown文件
- 统一格式要求的文档集合
- 定期批量处理文档需求
- 项目文档的整体转换
- **处理整个项目文件夹**
- **批量转换学术资料**

## 🔧 故障排除

### 常见问题

1. **"未找到wkhtmltopdf"错误**
   - 确保已正确安装wkhtmltopdf
   - 检查是否添加到系统PATH环境变量
   - 程序会提供手动指定路径的选项

2. **中文显示乱码**
   - 确保选择正确的编码格式（推荐UTF-8）
   - 检查Markdown文件本身的编码

3. **转换速度慢**
   - 大文件或多文件转换需要一定时间
   - 查看日志了解具体进度

4. **PDF格式问题**
   - 调整页面边距设置
   - 检查Markdown语法是否规范

5. **Emoji符号显示问题**
   - 参考[Emoji符号支持](#-emoji符号支持)章节
   - 检查系统字体安装情况
   - 验证PDF查看器兼容性

### 日志文件

程序会在同目录下生成 `markdown2pdf.log` 日志文件，包含详细的运行信息。
## 🧩 数学公式支持

### 当前支持的公式格式

**完全支持的标准LaTeX语法**：

```
# 基础数学
行内公式：$a^2 + b^2 = c^2$
分数：$\frac{a+b}{c-d}$ 或 $\frac{1}{n}\sum_{i=1}^{n} x_i$
平方根：$\sqrt{x}$ 或 $\sqrt[3]{x}$
上下标：$x_1^2$, $e^{i\pi}$, $H_2O$

# 微积分
导数：$\frac{dy}{dx}$, $\frac{\partial f}{\partial x}$
积分：$\int_a^b f(x) dx$, $\int_0^{\infty} e^{-x^2} dx$
极限：$\lim_{x \to 0}$, $\lim_{n \to \infty}$

# 统计学
平均值：$\bar{x} = \frac{1}{n}\sum_{i=1}^{n} x_i$
方差：$\sigma^2 = \frac{1}{n}\sum_{i=1}^{n} (x_i - \bar{x})^2$
标准差：$\sigma = \sqrt{\frac{1}{n}\sum_{i=1}^{n} (x_i - \bar{x})^2}$

# 化学方程式
$2H_2O \rightarrow 2H_2 + O_2$
$CH_4 + 2O_2 \rightarrow CO_2 + 2H_2O$

# 向量和矩阵
$\vec{v} = \begin{pmatrix} x \\ y \end{pmatrix}$
$\det(A) = |A|$
```

### 已修复的问题

✅ **平方根处理**：正确处理 `\sqrt{x}` 和 `\sqrt[3]{x}`  
✅ **偏导数显示**：正确显示 `\frac{\partial f}{\partial x}`  
✅ **平均值符号**：正确处理 `\bar{x}` 上划线  
✅ **化学分子式**：正确显示 `H_2O`, `CH_4` 等  
✅ **向量符号**：支持 `\vec{v}` 表示  
✅ **矩阵环境**：基本支持 `pmatrix` 环境  

### 支持的数学内容

- **基础运算**：+、-、×、÷、=、≠、≤、≥、±
- **函数符号**：sin、cos、tan、log、ln、exp
- **希腊字母**：α、β、γ、δ、θ、λ、μ、π、σ、φ、ω
- **特殊符号**：∞、∫、∑、∂、∇、∈、⊂、∪、∩
- **化学元素**：H₂O、CH₄、CO₂ 等下标格式
- **箭头符号**：→、↔、⇒、⇔

### 使用建议

1. **优先使用标准LaTeX语法**
2. **避免过于复杂的矩阵环境**
3. **测试文件验证**：使用 `fixed_math_test.md` 验证效果
4. **逐步添加复杂公式**：从简单到复杂逐步测试

### 已知限制

- 不支持复杂的array和tabular环境
- 不支持颜色和字体样式控制
- 极其复杂的多层嵌套公式可能显示简化
- 某些特殊的手写体或花体字母不支持

### 示例公式（推荐格式）

```
## 推荐的最佳实践

**基础运算**：
$a + b = c$, $x^2 + y^2 = z^2$, $\sqrt{a^2 + b^2}$

**统计公式**：
$\bar{x} = \frac{1}{n}\sum_{i=1}^{n} x_i$, $\sigma^2 = \frac{1}{n}\sum_{i=1}^{n} (x_i - \bar{x})^2$

**微积分**：
$\int_0^{\infty} e^{-x^2} dx = \frac{\sqrt{\pi}}{2}$, $\frac{\partial f}{\partial x}$

**化学反应**：
$2H_2O \rightarrow 2H_2 + O_2$, $CH_4 + 2O_2 \rightarrow CO_2 + 2H_2O$
```

## 📁 项目结构

```
Markdown转PDF工具/
├── Markdown2PDF.py                 # 主程序文件
├── requirements.txt                # Python依赖列表
├── README.md                      # 使用说明
├── markdown2pdf.log               # 运行日志（自动生成）
├── wkhtmltopdf_config.json        # 配置文件（自动生成）
├── test_sample.md                 # 基础测试文件
├── math_test.md                   # 数学公式测试文件（新增）
├── test_document2.md              # 批量测试文件
├── test_wkhtmltopdf_unified.py    # wkhtmltopdf 环境平台测试脚本
└── screenshots/                   # 界面截图（示例）
```

## 🆕 版本历史

### v2.6 综合测试套件版（当前版本）

- ✨ 全新统一测试框架，整合所有测试功能
- ✨ 智能路径查找算法，支持注册表深度搜索
- ✨ 权重化评分系统，提供精准的质量评估
- ✨ 全方位功能验证，包括性能基准测试
- ✨ 详细的诊断报告和改进建议
- ✨ 增强的异常处理和资源管理机制

### v2.5 数学公式支持版

- ✨ 全新集成MathJax数学公式渲染引擎
- ✨ 完整支持LaTeX数学公式语法
- ✨ 支持行内公式和块级公式
- ✨ 专业的数学符号和表达式渲染
- ✨ 添加专门的数学公式测试文件

### v2.4 文件夹批量添加功能

- ✨ 批量转换新增文件夹选择功能
- ✨ 支持递归搜索子文件夹中的Markdown文件
- ✨ 智能重复文件检测和过滤
- ✨ 详细的文件添加结果反馈

### v2.3 界面优化版

- ✨ 恢复页面设置为传统单列布局
- ✨ 保持单文件默认路径功能
- ✨ 优化整体界面布局

### v2.2 功能增强版

- ✨ 单文件转换默认输出到源文件同目录
- ✨ 全新优化的UI布局，消除空白区域
- ✨ 增强的路径预览和管理功能

### v2.1 主要特性

- ✨ 新增Tab页界面设计
- ✨ 支持单文件精确转换模式
- ✨ 增强的批量文件管理功能
- ✨ 实时文件名预览功能

### v2.0 核心功能

- 完善的依赖检查和自动安装
- 改进的错误处理机制
- 更丰富的页面设置选项
- 实时日志显示
- 配置文件持久化
- 更美观的用户界面

## 📞 技术支持

如遇到问题，请：

1. 查看日志文件 `markdown2pdf.log`
2. 检查是否满足系统要求
3. 确认wkhtmltopdf正确安装
4. 参考常见问题解决方案
5. 测试提供的数学公式示例文件
6. 运行统一测试套件进行诊断

## 📄 许可证

本项目仅供学习和使用。

---
**注意**：使用前请确保已安装所有必需的依赖项，特别是wkhtmltopdf工具。